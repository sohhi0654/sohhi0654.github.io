<!doctype html>
const demoFrame = document.getElementById('demoFrame');
const demoClose = document.getElementById('demoClose');
const fallbackLink = document.getElementById('fallbackLink');
const modalFallback = document.getElementById('modalFallback');


openBtn.addEventListener('click', (e) => {
e.preventDefault();
openDemoModal();
});


demoClose.addEventListener('click', () => closeDemoModal());


function openDemoModal(){
modalFallback.style.display = 'none';
demoFrame.style.display = '';
demoFrame.src = demoUrl + '?_ts=' + Date.now();
fallbackLink.href = demoUrl;
demoModal.setAttribute('aria-hidden','false');


// 読み込み検出（埋め込みブロック時は load が来ない or すぐにエラーになることがある）
let loaded = false;
const onLoad = () => { loaded = true; modalFallback.style.display = 'none'; };
demoFrame.addEventListener('load', onLoad, { once: true });


// 3秒待ってロードされなかったらフォールバック表示
setTimeout(() => {
if (!loaded) {
demoFrame.style.display = 'none';
modalFallback.style.display = 'block';
}
}, 3000);
}


function closeDemoModal(){
demoModal.setAttribute('aria-hidden','true');
// iframe を空にしてリソース解放
demoFrame.src = '';
}


// プレビューiframeがブロックされているかの簡易検出
const preview = document.getElementById('demoPreview');
let previewLoaded = false;
preview.addEventListener('load', () => { previewLoaded = true; });
setTimeout(() => {
if (!previewLoaded) {
// 埋め込みがブロックされている可能性を表示
const note = document.createElement('div');
note.className = 'note';
note.textContent = '※ このプレビューは埋め込みがブロックされているため表示されない可能性があります。ボタンで新しいタブを開いてください。';
document.getElementById('menuCard').appendChild(note);
}
}, 2500);


})();
</script>


<!-- Firebase 温度モニター -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
apiKey: "AIzaSyDUA7LwBaBupLcYMu-kzk7Hcv486IDiO8w",
authDomain: "azapon-temp-monitor.firebaseapp.com",
databaseURL: "https://azapon-temp-monitor-default-rtdb.asia-southeast1.firebasedatabase.app/",
projectId: "azapon-temp-monitor",
storageBucket: "azapon-temp-monitor.appspot.com",
messagingSenderId: "802815899884",
appId: "1:802815899884:web:be30065f2c815ad8dc0dc9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tempDisplay = document.getElementById('tempDisplay');


function updateTemp(temp) {
let statusText = '';
if (temp < 22) {
tempDisplay.className = 'temp-box warning';
statusText = '低すぎる！危険';
} else if (temp > 28) {
tempDisplay.className = 'temp-box warning';
statusText = '高すぎる！危険';
} else {
tempDisplay.className = 'temp-box safe';
statusText = '安全';
}
tempDisplay.innerHTML = `温度: ${temp.toFixed(1)} °C<br><span class="status-text">${statusText}</span>`;
}


db.ref('temperature').on('value', snapshot => {
const temp = snapshot.val();
if (temp !== null) updateTemp(temp);
});
</script>
</body>
</html>
