<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Azapon Camera ‚Äî Live Aquarium</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #0f1a2b;
      --accent: #3ddc97;
      --muted: #9fb0c8;
      --text: #e6f0f6;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: linear-gradient(180deg, #06111a 0%, var(--bg) 100%);
      font-family: system-ui, -apple-system, Segoe UI, Roboto,
        "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color: var(--text);
    }
    .wrap {
      min-height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 28px;
    }
    header {
      width: 100%;
      max-width: 1100px;
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .logo {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      background: linear-gradient(135deg, #0ee6a9, #18a3ff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #042;
      box-shadow: 0 6px 18px rgba(3, 15, 30, .6);
    }
    .title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.4px;
    }
    .subtitle {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }
    .card {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 8px 30px rgba(2, 8, 20, 0.6);
      border: 1px solid rgba(255,255,255,0.03);
      margin-bottom: 20px;
    }
    .stream-wrap {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }
    .stream {
      width: 100%;
      height: 0;
      padding-bottom: 56%;
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      background: #000;
    }
    .stream img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
      justify-content: center;
      margin-top: 6px;
    }
    button {
      background: var(--card);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.03);
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    button.primary {
      background: linear-gradient(90deg, var(--accent), #2ec1ff);
      color: #022;
      box-shadow: 0 6px 18px rgba(16,168,127,0.12);
    }
    .note {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      margin-top: 10px;
    }
    footer {
      margin-top: 20px;
      color: var(--muted);
      font-size: 12px;
    }
    @media(min-width:900px) {
      .stream { padding-bottom: 56%; }
    }
    @media(max-width:520px) {
      .title { font-size: 18px; }
      .logo { width: 48px; height: 48px; }
    }
    /* Ê∏©Â∫¶„Éú„ÉÉ„ÇØ„Çπ */
    .temp-box {
      font-size: 2em;
      font-weight: bold;
      text-align: center;
      padding: 18px 32px;
      border-radius: 16px;
      background: rgba(0,0,0,0.4);
      transition: color 0.5s, background 0.5s;
      margin-top: 12px;
    }
    .safe { color: #ffff66; }
    .warning { color: #ff6600; }
    .status-text {
      display: block;
      font-size: 1.1em;
      margin-top: 4px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">Az</div>
      <div>
        <div class="title">Azapon Camera</div>
        <div class="subtitle">Live Aquarium ‚Äî Ê∞¥ÊßΩ„É©„Ç§„Éñ</div>
      </div>
    </header>

    <!-- Êò†ÂÉè„Ç´„Éº„Éâ -->
    <main class="card">
      <div class="stream-wrap">
        <div class="stream" id="streamBox">
          <img id="mjpeg"
               src="https://stevens-had-casio-perception.trycloudflare.com/?action=stream"
               alt="Live stream" />
        </div>
        <div class="controls">
          <button id="reload">Reload</button>
          <button id="pop" class="primary">Open in new tab</button>
          <button id="fit">Fit / Cover</button>
        </div>
        <div class="note">
          „Åì„Çå„ÅßÊ∞¥ÊßΩ„ÅÆ„É©„Ç§„ÉñÈÖç‰ø°„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇÂïèÈ°å„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
          <br>‚Äª „Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆURL„ÇÑÈÖç‰ø°URL„ÅØ‰ªñ‰∫∫„Å´Êïô„Åà„Å™„ÅÑ„Åß„Å≠„ÄÇ
        </div>
      </div>
    </main>

    <!-- Ê∏©Â∫¶„É¢„Éã„Çø„Éº„Ç´„Éº„Éâ -->
    <div class="card">
      <div class="temp-box" id="tempDisplay">
        Ê∏©Â∫¶: -- ¬∞C<br><span class="status-text">---</span>
      </div>
    </div>

    <footer>Azapon Camera ‚Ä¢ live stream</footer>
  </div>

  <!-- Camera „Çπ„ÇØ„É™„Éó„Éà -->
  <script>
    (function(){
      const img = document.getElementById('mjpeg');
      const reload = document.getElementById('reload');
      const pop = document.getElementById('pop');
      const fit = document.getElementById('fit');
      let cover = true;

      reload.addEventListener('click', () => {
        const src = new URL(img.src);
        src.searchParams.set('_ts', Date.now());
        img.src = src.toString();
      });

      pop.addEventListener('click', () => {
        window.open(img.src, '_blank');
      });

      fit.addEventListener('click', () => {
        cover = !cover;
        img.style.objectFit = cover ? 'cover' : 'contain';
        fit.textContent = cover ? 'Fit / Cover' : 'Fit / Contain';
      });

      let retry = 0;
      img.addEventListener('error', () => {
        retry++;
        if (retry <= 5) {
          setTimeout(() => reload.click(), 800 * retry);
        } else {
          const box = document.getElementById('streamBox');
          box.innerHTML =
            '<div style="color:#fff;text-align:center;padding:30px">' +
            '„Çπ„Éà„É™„Éº„É†„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇÑÈÖç‰ø°ÂÅ¥„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ' +
            '</div>';
        }
      });

      img.style.objectFit = 'cover';
      img.decoding = 'async';
      img.loading = 'eager';
    })();
  </script>

  <!-- Firebase Ê∏©Â∫¶„É¢„Éã„Çø„Éº & Âº∑ÂåñË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDUA7LwBaBupLcYMu-kzk7Hcv486IDiO8w",
      authDomain: "azapon-temp-monitor.firebaseapp.com",
      databaseURL: "https://azapon-temp-monitor-default-rtdb.asia-southeast1.firebasedatabase.app/",
      projectId: "azapon-temp-monitor",
      storageBucket: "azapon-temp-monitor.appspot.com",
      messagingSenderId: "802815899884",
      appId: "1:802815899884:web:be30065f2c815ad8dc0dc9"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    const tempDisplay = document.getElementById('tempDisplay');

    // üîí Âº∑ÂåñË™çË®º„ÉÅ„Çß„ÉÉ„ÇØ
    auth.onAuthStateChanged(user => {
      if (!user) {
        // Êú™„É≠„Ç∞„Ç§„É≥„Å™„Çâ login.html „Å´ÂÆâÂÖ®„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
        window.location.replace("/login.html");
      } else {
        // ÁâπÂÆö„É¶„Éº„Ç∂„Éº„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπË®±ÂèØÔºàUID„ÇíËøΩÂä†Ôºâ
        const allowedUIDs = [
          "DDzxEFgzfSdxN9UW0VbOsGVyAza2",
        ];
        if (!allowedUIDs.includes(user.uid)) {
          alert("„Åì„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„ÅØ„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ„É≠„Ç∞„Ç§„É≥„ÅóÁõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
          auth.signOut().then(() => {
            window.location.replace("https://www.azarasimidi.f5.si/login.html");
          });
        } else {
          console.log("‚úÖ „É≠„Ç∞„Ç§„É≥Ê∏à„Åø:", user.email);
        }
      }
    });

    // Ê∏©Â∫¶Ë°®Á§∫Êõ¥Êñ∞
    function updateTemp(temp) {
      let statusText = '';
      if (temp < 22) {
        tempDisplay.className = 'temp-box warning';
        statusText = '‰Ωé„Åô„Åé„ÇãÔºÅÂç±Èô∫';
      } else if (temp > 28) {
        tempDisplay.className = 'temp-box warning';
        statusText = 'È´ò„Åô„Åé„ÇãÔºÅÂç±Èô∫';
      } else {
        tempDisplay.className = 'temp-box safe';
        statusText = 'ÂÆâÂÖ®';
      }
      tempDisplay.innerHTML =
        `Ê∏©Â∫¶: ${temp.toFixed(1)} ¬∞C<br><span class="status-text">${statusText}</span>`;
    }

    db.ref('temperature').on('value', snapshot => {
      const temp = snapshot.val();
      if (temp !== null) updateTemp(temp);
    });
  </script>
</body>
</html>
